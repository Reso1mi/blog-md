---
title: 
 KMPç®—æ³•
tags: 
  [æ•°æ®ç»“æ„,ç®—æ³•]
categories:
	[ç®—æ³•]
---

## å‰è¨€

ä¹‹å‰å¤§ä¸€çš„æ—¶å€™å†™è¿‡ä¸€ç¯‡å…³äºKMPçš„åšå®¢ï¼Œå†™çš„ä¹Ÿæ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œè‡ªå·±çœ‹ç€éƒ½è´¹åŠ²ï¼Œæœ€è¿‘çœ‹å·¦ç¥çš„ä¹¦ã€Šç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—ã€‹æœ‰è®²ï¼Œé‡æ–°å­¦äº†ä¸€éï¼Œæ„Ÿè§‰å†™çš„è¿˜æ˜¯æŒºå¥½çš„ï¼Œè¿™ç¯‡å°±ä¸ä»0å¼€å§‹è®²è§£`KMP`äº†ï¼Œç®€å•è¯´ä¸€äº›è¦ç‚¹ï¼Œæ–¹ä¾¿ä»¥åå›é¡¾

> æˆ‘è®°å¾—å¤§ä¸€ä¸ºäº†ææ‡‚kmpå¥½åƒèŠ±äº†æŒºé•¿æ—¶é—´çš„ï¼Œç½‘ä¸Šç¿»å„ç§åšå®¢ï¼Œæäº†å¤§åŠå¤©å§ï¼Œç»“æœè¿˜æ˜¯æ²¡å’‹ææ¸…æ¥šï¼Œå‰å‡ å¤©çœ‹ä¹¦å¤§æ¦‚åªèŠ±äº†ä¸€ä¸ªå°æ—¶å·¦å³å°±éƒ½ææ¸…æ¥šäº†ï¼Œå¯èƒ½æ˜¯å·¦ç¥å†™çš„æ¯”è¾ƒå¥½å§ğŸ˜‚

## nextæ•°ç»„æ˜¯ä»€ä¹ˆï¼Ÿ

`kmp`æœ€å…³é”®çš„åœ°æ–¹å°±æ˜¯è¿™ä¸ª`next`æ•°ç»„äº†ï¼Œ`next`æ•°ç»„å°±æ˜¯å„ä¸ªå­ä¸²çš„å‰ç¼€åç¼€æœ€å¤§åŒ¹é…ï¼ˆç›¸ç­‰ï¼‰é•¿åº¦ï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯`next[i]`ä»£è¡¨çš„å°±æ˜¯å­ä¸²`i`ä½ç½®å‰å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬`i`ä½ç½®ï¼‰çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦

ä¸¾ä¸ªä¾‹å­ï¼š å­ä¸²`abababc`  

next[3] = "aba" çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦ = 1 (å¼€å¤´çš„aå’Œç»“å°¾çš„aåŒ¹é…)

next[6]= "ababab" çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦ = 4 ï¼ˆå¼€å¤´çš„ababå’Œç»“å°¾çš„ababåŒ¹é…ï¼‰

## nextæ•°ç»„çš„ä½œç”¨ï¼Ÿ

ä»–çš„ä½œç”¨å…¶å®å°±æ˜¯åœ¨ä¸¤ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒå¤±é…çš„æ—¶å€™é¿å…ç›®æ ‡ä¸²å›æº¯ï¼Œå¸¸è§„çš„æš´åŠ›åŒ¹é…åœ¨å­—ç¬¦å¤±é…çš„æ—¶å€™å°±ä¼šå›é€€åˆ°é¦–å­—ç¬¦é‡æ–°åŒ¹é…ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦å°±æ˜¯`O(m*n)`ï¼Œè€Œnextæ•°ç»„å°±æ˜¯ä¸ºäº†é¿å…å›é€€ï¼Œç®€å•ä¸¾ä¸€ä¸ªä¾‹å­

![mark](http://static.imlgw.top/blog/20200513/ugvgLhmyaeBr.png?imageslim)

ç”¨PPTç®€å•çš„ç”»äº†ä¸ªå›¾ï¼ˆPPTçœŸå¥½ç”¨ï¼‰ï¼Œå½“åŒ¹é…åˆ°**æ¯ä¸²å’Œå­ä¸²**`index=6`çš„ä½ç½®æ—¶ï¼Œå‘ç°ä¸¤è€…çš„å­—ç¬¦ä¸ç›¸åŒï¼ŒæŒ‰ç…§æš´åŠ›åŒ¹é…ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ¯ä¸²å›æº¯åˆ°`index=1`ä¹Ÿå°±æ˜¯bå­—ç¬¦ä½ç½®ï¼Œå­ä¸²å›æº¯åˆ°é¦–å­—ç¬¦ï¼Œé‡æ–°å¼€å§‹åŒ¹é…ï¼Œç›´åˆ°åŒ¹é…åˆ°å­ä¸²ï¼Œæˆ–è€…åŒ¹é…å®Œæ¯ä¸²æ‰€æœ‰å­ä¸²ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æœ‰äº†`next`æ•°ç»„ï¼Œæˆ‘ä»¬çš„æ¯ä¸²å°±ä¸å¿…å†å›é€€äº†ï¼Œè€Œå­ä¸²ä¹Ÿä¸å¿…å†å›é€€åˆ°é¦–å­—ç¬¦äº†ï¼Œå›¾ä¸­çš„é»„è‰²ä¸‹åˆ’çº¿å’Œç»¿è‰²ä¸‹åˆ’çº¿ä»£è¡¨çš„å°±æ˜¯**å­ä¸²index=6**ä½ç½®å‰çš„æœ€é•¿å‰åç¼€åŒ¹é…é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯`ababab`çš„**æœ€é•¿å‰åç¼€åŒ¹é…å­—ç¬¦**ï¼Œå½“å­ä¸²index=6ä½ç½®çš„å­—ç¬¦åŒ¹é…ä¸ä¸Šçš„æ—¶å€™æˆ‘ä»¬æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†`index`è·³åˆ°`next[6]`ï¼Œä¹Ÿå°±æ˜¯å°†å­ä¸²ç´¢å¼•ç§»åŠ¨åˆ°index=4çš„ä½ç½®ï¼Œå°±å˜æˆä¸‹é¢è¿™æ ·

![mark](http://static.imlgw.top/blog/20200513/6sBvml0hXrr6.png?imageslim)

æ¯ä¸²å¹¶æ²¡æœ‰å›é€€ï¼Œç»§ç»­åŒ¹é…`æ¯ä¸²index=6`å’Œå­ä¸²`index=4`ä½ç½®çš„å…ƒç´ ï¼Œç„¶åé‡å¤ä¸Šé¢çš„è¿‡ç¨‹

## ä¸ºä»€ä¹ˆå­ä¸²å¯ä»¥ç›´æ¥æ»‘åŠ¨next[i]æ­¥ï¼Ÿ

å‰é¢æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨`next`æ•°ç»„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå­ä¸²å¯ä»¥ä¸€ä¸‹å­ä»æ»‘åŠ¨åˆ°`next[i]`ä½ç½®å‘¢ï¼Ÿä¸‡ä¸€ä¸­é—´æœ‰èƒ½åŒ¹é…çš„å­—ç¬¦ä¸å°±æ»‘è¿‡äº†ä¹ˆï¼Ÿ

æˆ‘ä»¬å‡è®¾åœ¨æ¯ä¸²ä¸­é—´å­˜åœ¨æŸä¸€ä¸ªä½ç½®èƒ½åŒ¹é…å‡ºå­ä¸²ï¼Œä¸”è¯¥ä½ç½®åœ¨**å­ä¸²æœ€é•¿åŒ¹é…åç¼€ä¹‹å‰**ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™éƒ¨åˆ†**æ¯”å½“å‰çš„æœ€é•¿å‰åç¼€åŒ¹é…é•¿åº¦è¿˜è¦é•¿**å¯¹åº”åˆ°ä¸‹å›¾å°±æ˜¯é»‘è‰²è™šçº¿æ¡†æ¡†å‡ºæ¥çš„éƒ¨åˆ†

![mark](http://static.imlgw.top/blog/20200513/EbC0E1JvbkHh.png?imageslim)

æ—¢ç„¶èƒ½ä»è¿™ä¸ªä½ç½®åŒ¹é…å‡ºå­ä¸²ï¼Œé‚£ä¹ˆè¯´æ˜æˆ‘çš„**å­ä¸²çš„å‰ç¼€**å’Œè¿™ä¸€éƒ¨åˆ†ç›¸ç­‰ï¼ŒåŒæ—¶ï¼Œç”±äºå¤±é…å‰å­ä¸²å’Œæ¯ä¸²æ˜¯å®Œå…¨åŒ¹é…çš„ï¼Œæ‰€ä»¥æˆ‘**å­ä¸²çš„åç¼€**å’Œè¿™ä¸€éƒ¨åˆ†è‚¯å®šä¹Ÿæ˜¯ç›¸ç­‰çš„ï¼Œè¯¶ï¼Ÿæˆ‘å­ä¸²å‰åç¼€éƒ½å’Œè¿™éƒ¨åˆ†ç›¸ç­‰ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘çš„åŒ¹é…å‰åç¼€å•Šï¼Œä½†æ˜¯è¿™éƒ¨åˆ†åˆæ¯”æˆ‘çš„æœ€é•¿å‰åç¼€é•¿åº¦è¦é•¿ï¼Œæ˜¯ä¸æ˜¯çŸ›ç›¾äº†ï¼Ÿæ‰€ä»¥åŸå‡è®¾æ˜¯ä¸æˆç«‹çš„ï¼Œä¸å­˜åœ¨è¿™æ ·çš„ä½ç½®ï¼æ‰€ä»¥å­ä¸²å¯ä»¥æ”¾å¿ƒçš„æ»‘åˆ°`next[i]`ä½ç½®

## nextæ•°ç»„å¦‚ä½•æ±‚ï¼Ÿ

è¯´äº†è¿™ä¹ˆå¤šnextæ•°ç»„ï¼Œé‚£ä¹ˆnextæ•°ç»„ç©¶ç«Ÿæ€ä¹ˆæ±‚å‘¢ï¼Ÿå…¶å®æ•´ä¸ªçš„æ±‚è§£è¿‡ç¨‹æœ‰ç‚¹åƒåŠ¨æ€è§„åˆ’ï¼Œæœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ä¸‹

> æƒ³èµ·æ¥äº†å†å†™

## æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯çº¿æ€§çš„ï¼Ÿ

> æƒ³èµ·æ¥äº†å†å†™

## ä¾‹é¢˜

### [28. å®ç° strStr()](https://leetcode-cn.com/problems/implement-strstr/)

å®ç° [strStr()](https://baike.baidu.com/item/strstr/811469) å‡½æ•°ã€‚

ç»™å®šä¸€ä¸ª haystack å­—ç¬¦ä¸²å’Œä¸€ä¸ª needle å­—ç¬¦ä¸²ï¼Œåœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® (ä»0å¼€å§‹)ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  **-1**ã€‚

**ç¤ºä¾‹ 1:**

```java
è¾“å…¥: haystack = "hello", needle = "ll"
è¾“å‡º: 2
```

**ç¤ºä¾‹ 2:**

```java
è¾“å…¥: haystack = "aaaaa", needle = "bba"
è¾“å‡º: -1
```

**è¯´æ˜:**

å½“ `needle` æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚

å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ `needle` æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸Cè¯­è¨€çš„ [strstr()](https://baike.baidu.com/item/strstr/811469) ä»¥åŠ Javaçš„ [indexOf()](https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#indexOf(java.lang.String)) å®šä¹‰ç›¸ç¬¦ã€‚

**è§£æ³•ä¸€**

æ ‡æ³¨çš„æ˜¯ç®€å•ï¼Œå¾ˆå¤šäººéƒ½æ˜¯ç›´æ¥è°ƒçš„APIï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰æ²¡å•¥æ„ä¹‰ï¼Œæ‰€ä»¥è¿™é¢˜åº”è¯¥ç›´æ¥ä¸Škmp

```java
public int strStr(String haystack, String needle) {
    if(needle==null || needle.length()<=0) return 0;
    if(haystack==null ||haystack.length()<=0) return -1;
    int[] next=getNext(needle);
    int tidx=0,sidx=0;
    while (sidx<haystack.length() && tidx<needle.length()) {
        if(needle.charAt(tidx) == haystack.charAt(sidx)){
            tidx++;sidx++;
            if(tidx==needle.length()){
                return sidx-tidx;
            }
        }else if(next[tidx]==-1){
            //å®Œå…¨å¤±é…sidxéœ€è¦åç§»
            sidx++;
        }else{
            tidx=next[tidx];
        }
    }
    return -1;
}

//æ±‚tçš„next
//abadabac
//ac
public int[] getNext(String t){
    int[] next= new int[t.length()];
    next[0]=-1;
    if(t.length()<=1) return next;
    next[1]=0;
    int left=0,right=2;
    while(right<t.length()){
        if(t.charAt(left)==t.charAt(right-1)){
            left++;
            next[right++]=left;
        }else if(left<=0){
            next[right++]=0;
        }else{
            left=next[left];
        }
    }
    return next;
}
```
æ²¡å•¥å¥½è¯´çš„ï¼Œè£¸kmp

### [459. é‡å¤çš„å­å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/repeated-substring-pattern/)

ç»™å®šä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦å¯ä»¥ç”±å®ƒçš„ä¸€ä¸ªå­ä¸²é‡å¤å¤šæ¬¡æ„æˆã€‚ç»™å®šçš„å­—ç¬¦ä¸²åªå«æœ‰å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”é•¿åº¦ä¸è¶…è¿‡10000ã€‚

**ç¤ºä¾‹ 1:**

```java
è¾“å…¥: "abab"

è¾“å‡º: True

è§£é‡Š: å¯ç”±å­å­—ç¬¦ä¸² "ab" é‡å¤ä¸¤æ¬¡æ„æˆã€‚
```

**ç¤ºä¾‹ 2:**

```java
è¾“å…¥: "aba"

è¾“å‡º: False
```

**ç¤ºä¾‹ 3:**

```java
è¾“å…¥: "abcabcabcabc"

è¾“å‡º: True

è§£é‡Š: å¯ç”±å­å­—ç¬¦ä¸² "abc" é‡å¤å››æ¬¡æ„æˆã€‚ (æˆ–è€…å­å­—ç¬¦ä¸² "abcabc" é‡å¤ä¸¤æ¬¡æ„æˆã€‚)
```

**è§£æ³•ä¸€**

è¿™é¢˜æ ‡æ³¨çš„ä¹Ÿæ˜¯ç®€å•ï¼Œç¡®å®æš´åŠ›çš„è§£æ³•ä¸éš¾æƒ³åˆ°ï¼Œä½†æ˜¯å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥å°±ç›´æ¥ä¸Škmp

```java
//20msï¼Œåšå¤æ‚äº†ï¼Œæ„é€ äº†ä¸€ä¸ªs+sç„¶åå»æ‰å¤´ï¼Œå†åœ¨é‡Œé¢kmpæ‰¾
public boolean repeatedSubstringPattern(String s) {
    if(s==null || s.length()<=0) return false;
    String t=s+s;
    int[] next=getNext(s);
    int i=0,j=1; //å»æ‰å¤´
    while(i<s.length() && j<t.length()){
        if(s.charAt(i)==t.charAt(j)){
            i++;j++;
        }else if(next[i]==-1){
            j++;
        }else{
            i=next[i];
        }
    }
    return j-i!=s.length();
}

public int[] getNext(String s){
    if(s.length()==1){
        return new int[]{-1};
    }
    int[] next=new int[s.length()];
    next[0]=-1;
    next[1]=0;
    int left=0,right=2; 
    while(right<s.length()){
        if(s.charAt(left)==s.charAt(right-1)){
            next[right++]=++left;
        }else if(left<=0){
            next[right++]=0;
        }else{
            left=next[left];
        }
    }
    return next;
}
```
è¿™ä¸ªè§£æ³•å…¶å®æ„é€ äº†ä¸€ä¸ª`s+s`çš„å­—ç¬¦`t`ï¼Œç„¶åå»æ‰å¤´ï¼Œåœ¨`t[1:]`ä¸­æ‰¾åŸ`s`ï¼Œæœ€åæ‰¾åˆ°çš„ä½ç½®åªè¦ä¸æ˜¯`s+s`è¿æ¥å¤„ï¼Œä¹Ÿå°±æ˜¯`s.length()`ä½ç½®ï¼Œé‚£ä¹ˆå°±è‚¯å®šæ˜¯é‡å¤çš„æœ‰å¾ªç¯çš„ï¼Œå…¶å®è¿™ä¸ªç»“è®ºåœ¨å†™çš„æ—¶å€™å¹¶æ²¡æœ‰è¯æ˜ï¼Œå®Œå…¨æ˜¯çŒœçš„ğŸ˜‚ï¼Œç®€å•è¯æ˜ä¸‹ï¼Œä¸€å›¾èƒœå‰è¨€

![mark](http://static.imlgw.top/blog/20200513/O4Nmz343e9Li.png?imageslim)

**è§£æ³•äºŒ**

å…¶å®åªéœ€è¦æ„é€ nextæ•°ç»„ï¼Œæ ¹æ®nextæ•°ç»„å°±å¯ä»¥åˆ¤æ–­æ˜¯ä¸æ˜¯é‡å¤çš„ï¼Œæˆ‘ä»¬çœ‹å‡ ç»„æ•°æ®

```java
   s:  a b c a b c a b c a b c \0
next: -1 0 0 0 1 2 3 4 5 6 7 8  9
   s:  a a b a b d \0
next: -1 0 1 0 1 0  0
   s:  a b c d a b \0
next: -1 0 0 0 0 1 2 
```

ç›¸æ¯”å¸¸è§„çš„KMPç®—æ³•ï¼Œæˆ‘ä»¬åœ¨å­—ç¬¦æœ€åæœ€åä¹ŸåŠ äº†`next`ä½ï¼Œå…¶å®æ˜¯ä¸ºäº†åŒºåˆ«ä¸‹é¢çš„æƒ…å†µ

```
   s:  a b a b \0
next: -1 0 0 1 2
   s:  a b a c \0
next: -1 0 0 1 0
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œnextæ•°ç»„åœ¨è¿‡äº†ä¸€å®šçš„èŒƒå›´åå°±å¼€å§‹é€æ¸é€’å¢äº†ï¼Œè€Œè¿™ä¸ªé€’å¢çš„æ‹ç‚¹å°±æ˜¯åœ¨ç¬¬ä¸€ä¸ªå¾ªç¯èŠ‚ç»“æŸçš„æ—¶å€™ï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘å°±ä¸è¯¦ç»†è¯æ˜äº†ï¼Œå…¶å®ä¹Ÿå¾ˆå¥½æƒ³å› ä¸ºè¿‡äº†å¾ªç¯èŠ‚ï¼Œåé¢çš„éƒ½æ˜¯å’Œå‰é¢é‡å¤çš„ï¼Œæ‰€ä»¥æ¯å¤šä¸€ä¸ªå­—ç¬¦`next[i]=next[i-1]+1`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å­—ç¬¦çš„é•¿åº¦å‡å»`next[slen]`å°±å¯ä»¥å¾—åˆ°å¾ªç¯ç»“çš„é•¿åº¦ï¼Œæˆ‘ä»¬åªéœ€è¦éªŒè¯è¿™ä¸ªå¾ªç¯èŠ‚èƒ½å¦è¢«`s`å­—ç¬¦ä¸²é•¿åº¦æ•´é™¤å°±å¯ä»¥äº†ï¼ŒåŒæ—¶éœ€è¦é˜²æ­¢å¾ªç¯èŠ‚é•¿åº¦ç­‰äºå­—ç¬¦ä¸²é•¿åº¦çš„æƒ…å†µ

```java
public boolean repeatedSubstringPattern(String s) {
    if(s==null || s.length()<=1) return false;
    int[] next=getNext(s);
    int replen=s.length()-next[s.length()];
    return s.length()%replen==0;
}

public int[] getNext(String s){
    if(s.length()==1){
        return new int[]{-1};
    }
    int[] next=new int[s.length()+1];
    next[0]=-1;
    next[1]=0;
    int left=0,right=2; 
    while(right<=s.length()){
        if(s.charAt(left)==s.charAt(right-1)){
            next[right++]=++left;
        }else if(left<=0){
            next[right++]=0;
        }else{
            left=next[left];
        }
    }
    return next;
}
```

å®åœ¨ä¸è¡ŒæŠŠè¿™ä¸ªè®°ä½å°±è¡Œäº†ï¼Œåæ­£æˆ‘æ˜¯è®°ä½äº†ğŸ˜‚