---
title: KMP ç®—æ³•
tags:
  - æ•°æ®ç»“æ„
  - ç®—æ³•
categories:
  - ç®—æ³•
date: 2020/5/13
abbrlink: 2da0528d
---

## å‰è¨€

ä¹‹å‰å¤§ä¸€çš„æ—¶å€™å†™è¿‡ä¸€ç¯‡å…³äº KMP çš„åšå®¢ï¼Œå†™çš„ä¹Ÿæ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„ï¼Œè‡ªå·±çœ‹ç€éƒ½è´¹åŠ²ï¼Œæœ€è¿‘çœ‹å·¦ç¥çš„ä¹¦ã€Šç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—ã€‹æœ‰è®²ï¼Œé‡æ–°å­¦äº†ä¸€éï¼Œæ„Ÿè§‰å†™çš„è¿˜æ˜¯æŒºå¥½çš„ï¼Œè¿™ç¯‡å°±ä¸ä» 0 å¼€å§‹è®²è§£`KMP`äº†ï¼Œç®€å•è¯´ä¸€äº›è¦ç‚¹ï¼Œæ–¹ä¾¿ä»¥åå›é¡¾

> æˆ‘è®°å¾—å¤§ä¸€ä¸ºäº†ææ‡‚ kmp å¥½åƒèŠ±äº†æŒºé•¿æ—¶é—´çš„ï¼Œç½‘ä¸Šç¿»å„ç§åšå®¢ï¼Œæäº†å¤§åŠå¤©å§ï¼Œç»“æœè¿˜æ˜¯æ²¡å’‹ææ¸…æ¥šï¼Œå‰å‡ å¤©çœ‹ä¹¦å¤§æ¦‚åªèŠ±äº†ä¸€ä¸ªå°æ—¶å·¦å³å°±éƒ½ææ¸…æ¥šäº†ï¼Œå¯èƒ½æ˜¯å·¦ç¥å†™çš„æ¯”è¾ƒå¥½å§ğŸ˜‚

## next æ•°ç»„æ˜¯ä»€ä¹ˆï¼Ÿ

`kmp`æœ€å…³é”®çš„åœ°æ–¹å°±æ˜¯è¿™ä¸ª`next`æ•°ç»„äº†ï¼Œ`next`æ•°ç»„å°±æ˜¯å„ä¸ªå­ä¸²çš„å‰ç¼€åç¼€æœ€å¤§åŒ¹é…ï¼ˆç›¸ç­‰ï¼‰é•¿åº¦ï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯`next[i]`ä»£è¡¨çš„å°±æ˜¯å­ä¸²`i`ä½ç½®å‰å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬`i`ä½ç½®ï¼‰çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦

ä¸¾ä¸ªä¾‹å­ï¼š å­ä¸²`abababc`  

next[3] = "aba" çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦ = 1 ï¼ˆå¼€å¤´çš„ a å’Œç»“å°¾çš„ a åŒ¹é…ï¼‰

next[6]= "ababab" çš„å‰åç¼€æœ€å¤§åŒ¹é…é•¿åº¦ = 4 ï¼ˆå¼€å¤´çš„ abab å’Œç»“å°¾çš„ abab åŒ¹é…ï¼‰

## next æ•°ç»„çš„ä½œç”¨ï¼Ÿ

ä»–çš„ä½œç”¨å…¶å®å°±æ˜¯åœ¨ä¸¤ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒå¤±é…çš„æ—¶å€™é¿å…ç›®æ ‡ä¸²å›æº¯ï¼Œå¸¸è§„çš„æš´åŠ›åŒ¹é…åœ¨å­—ç¬¦å¤±é…çš„æ—¶å€™å°±ä¼šå›é€€åˆ°é¦–å­—ç¬¦é‡æ–°åŒ¹é…ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦å°±æ˜¯`O(m*n)`ï¼Œè€Œ next æ•°ç»„å°±æ˜¯ä¸ºäº†é¿å…å›é€€ï¼Œç®€å•ä¸¾ä¸€ä¸ªä¾‹å­

![mark](http://static.imlgw.top/blog/20200513/ugvgLhmyaeBr.png?imageslim)

ç”¨ PPT ç®€å•çš„ç”»äº†ä¸ªå›¾ï¼ˆPPT çœŸå¥½ç”¨ï¼‰ï¼Œå½“åŒ¹é…åˆ°**æ¯ä¸²å’Œå­ä¸²**`index=6`çš„ä½ç½®æ—¶ï¼Œå‘ç°ä¸¤è€…çš„å­—ç¬¦ä¸ç›¸åŒï¼ŒæŒ‰ç…§æš´åŠ›åŒ¹é…ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ¯ä¸²å›æº¯åˆ°`index=1`ä¹Ÿå°±æ˜¯ b å­—ç¬¦ä½ç½®ï¼Œå­ä¸²å›æº¯åˆ°é¦–å­—ç¬¦ï¼Œé‡æ–°å¼€å§‹åŒ¹é…ï¼Œç›´åˆ°åŒ¹é…åˆ°å­ä¸²ï¼Œæˆ–è€…åŒ¹é…å®Œæ¯ä¸²æ‰€æœ‰å­ä¸²ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æœ‰äº†`next`æ•°ç»„ï¼Œæˆ‘ä»¬çš„æ¯ä¸²å°±ä¸å¿…å†å›é€€äº†ï¼Œè€Œå­ä¸²ä¹Ÿä¸å¿…å†å›é€€åˆ°é¦–å­—ç¬¦äº†ï¼Œå›¾ä¸­çš„é»„è‰²ä¸‹åˆ’çº¿å’Œç»¿è‰²ä¸‹åˆ’çº¿ä»£è¡¨çš„å°±æ˜¯**å­ä¸² index=6 **ä½ç½®å‰çš„æœ€é•¿å‰åç¼€åŒ¹é…é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯`ababab`çš„**æœ€é•¿å‰åç¼€åŒ¹é…å­—ç¬¦**ï¼Œå½“å­ä¸² index=6 ä½ç½®çš„å­—ç¬¦åŒ¹é…ä¸ä¸Šçš„æ—¶å€™æˆ‘ä»¬æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†`index`è·³åˆ°`next[6]`ï¼Œä¹Ÿå°±æ˜¯å°†å­ä¸²ç´¢å¼•ç§»åŠ¨åˆ° index=4 çš„ä½ç½®ï¼Œå°±å˜æˆä¸‹é¢è¿™æ ·

![mark](http://static.imlgw.top/blog/20200513/6sBvml0hXrr6.png?imageslim)

æ¯ä¸²å¹¶æ²¡æœ‰å›é€€ï¼Œç»§ç»­åŒ¹é…`æ¯ä¸² index=6`å’Œå­ä¸²`index=4`ä½ç½®çš„å…ƒç´ ï¼Œç„¶åé‡å¤ä¸Šé¢çš„è¿‡ç¨‹

## ä¸ºä»€ä¹ˆå­ä¸²å¯ä»¥ç›´æ¥æ»‘åŠ¨ next[i] æ­¥ï¼Ÿ

å‰é¢æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ä½¿ç”¨`next`æ•°ç»„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå­ä¸²å¯ä»¥ä¸€ä¸‹å­ä»æ»‘åŠ¨åˆ°`next[i]`ä½ç½®å‘¢ï¼Ÿä¸‡ä¸€ä¸­é—´æœ‰èƒ½åŒ¹é…çš„å­—ç¬¦ä¸å°±æ»‘è¿‡äº†ä¹ˆï¼Ÿ

æˆ‘ä»¬å‡è®¾åœ¨æ¯ä¸²ä¸­é—´å­˜åœ¨æŸä¸€ä¸ªä½ç½®èƒ½åŒ¹é…å‡ºå­ä¸²ï¼Œä¸”è¯¥ä½ç½®åœ¨**å­ä¸²æœ€é•¿åŒ¹é…åç¼€ä¹‹å‰**ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™éƒ¨åˆ†**æ¯”å½“å‰çš„æœ€é•¿å‰åç¼€åŒ¹é…é•¿åº¦è¿˜è¦é•¿**å¯¹åº”åˆ°ä¸‹å›¾å°±æ˜¯é»‘è‰²è™šçº¿æ¡†æ¡†å‡ºæ¥çš„éƒ¨åˆ†

![mark](http://static.imlgw.top/blog/20200513/EbC0E1JvbkHh.png?imageslim)

æ—¢ç„¶èƒ½ä»è¿™ä¸ªä½ç½®åŒ¹é…å‡ºå­ä¸²ï¼Œé‚£ä¹ˆè¯´æ˜æˆ‘çš„**å­ä¸²çš„å‰ç¼€**å’Œè¿™ä¸€éƒ¨åˆ†ç›¸ç­‰ï¼ŒåŒæ—¶ï¼Œç”±äºå¤±é…å‰å­ä¸²å’Œæ¯ä¸²æ˜¯å®Œå…¨åŒ¹é…çš„ï¼Œæ‰€ä»¥æˆ‘**å­ä¸²çš„åç¼€**å’Œè¿™ä¸€éƒ¨åˆ†è‚¯å®šä¹Ÿæ˜¯ç›¸ç­‰çš„ï¼Œè¯¶ï¼Ÿæˆ‘å­ä¸²å‰åç¼€éƒ½å’Œè¿™éƒ¨åˆ†ç›¸ç­‰ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘çš„åŒ¹é…å‰åç¼€å•Šï¼Œä½†æ˜¯è¿™éƒ¨åˆ†åˆæ¯”æˆ‘çš„æœ€é•¿å‰åç¼€é•¿åº¦è¦é•¿ï¼Œæ˜¯ä¸æ˜¯çŸ›ç›¾äº†ï¼Ÿæ‰€ä»¥åŸå‡è®¾æ˜¯ä¸æˆç«‹çš„ï¼Œä¸å­˜åœ¨è¿™æ ·çš„ä½ç½®ï¼æ‰€ä»¥å­ä¸²å¯ä»¥æ”¾å¿ƒçš„æ»‘åˆ°`next[i]`ä½ç½®

## next æ•°ç»„å¦‚ä½•æ±‚ï¼Ÿ

è¯´äº†è¿™ä¹ˆå¤š next æ•°ç»„ï¼Œé‚£ä¹ˆ next æ•°ç»„ç©¶ç«Ÿæ€ä¹ˆæ±‚å‘¢ï¼Ÿå…¶å®æ•´ä¸ªçš„æ±‚è§£è¿‡ç¨‹æœ‰ç‚¹åƒåŠ¨æ€è§„åˆ’ï¼Œæœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ä¸‹

> æƒ³èµ·æ¥äº†å†å†™

## æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯çº¿æ€§çš„ï¼Ÿ

> æƒ³èµ·æ¥äº†å†å†™

## ä¾‹é¢˜

### [28. å®ç° strStr()](https://leetcode-cn.com/problems/implement-strstr/)

å®ç° [strStr()](https://baike.baidu.com/item/strstr/811469) å‡½æ•°ã€‚

ç»™å®šä¸€ä¸ª haystack å­—ç¬¦ä¸²å’Œä¸€ä¸ª needle å­—ç¬¦ä¸²ï¼Œåœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® ï¼ˆä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  **-1**ã€‚

**ç¤ºä¾‹ 1:**

```java
è¾“å…¥ï¼šhaystack = "hello", needle = "ll"
è¾“å‡ºï¼š2
```

**ç¤ºä¾‹ 2:**

```java
è¾“å…¥ï¼šhaystack = "aaaaa", needle = "bba"
è¾“å‡ºï¼š-1
```

**è¯´æ˜ï¼š**

å½“ `needle` æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚

å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ `needle` æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸ C è¯­è¨€çš„ [strstr()](https://baike.baidu.com/item/strstr/811469) ä»¥åŠ Java çš„ [indexOf()](https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#indexOf(java.lang.String)) å®šä¹‰ç›¸ç¬¦ã€‚

**è§£æ³•ä¸€**

æ ‡æ³¨çš„æ˜¯ç®€å•ï¼Œå¾ˆå¤šäººéƒ½æ˜¯ç›´æ¥è°ƒçš„ APIï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰æ²¡å•¥æ„ä¹‰ï¼Œæ‰€ä»¥è¿™é¢˜åº”è¯¥ç›´æ¥ä¸Š kmp

```java
public int strStr(String haystack, String needle) {
    if(needle==null || needle.length()<=0) return 0;
    if(haystack==null ||haystack.length()<=0) return -1;
    int[] next=getNext(needle);
    int tidx=0,sidx=0;
    while (sidx<haystack.length() && tidx<needle.length()) {
        if(needle.charAt(tidx) == haystack.charAt(sidx)){
            tidx++;sidx++;
            if(tidx==needle.length()){
                return sidx-tidx;
            }
        }else if(next[tidx]==-1){
            //å®Œå…¨å¤±é… sidx éœ€è¦åç§»
            sidx++;
        }else{
            tidx=next[tidx];
        }
    }
    return -1;
}

//æ±‚ t çš„ next
//abadabac
//ac
public int[] getNext(String t){
    int[] next= new int[t.length()];
    next[0]=-1;
    if(t.length()<=1) return next;
    next[1]=0;
    int left=0,right=2;
    while(right<t.length()){
        if(t.charAt(left)==t.charAt(right-1)){
            left++;
            next[right++]=left;
        }else if(next[left]==-1){ //æ— æ³•åŒ¹é…äº†
            right++; //next[right]=0
        }else{
            left=next[left];
        }
    }
    return next;
}
```
æ²¡å•¥å¥½è¯´çš„ï¼Œè£¸ kmp

### [459. é‡å¤çš„å­å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/repeated-substring-pattern/)

ç»™å®šä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦å¯ä»¥ç”±å®ƒçš„ä¸€ä¸ªå­ä¸²é‡å¤å¤šæ¬¡æ„æˆã€‚ç»™å®šçš„å­—ç¬¦ä¸²åªå«æœ‰å°å†™è‹±æ–‡å­—æ¯ï¼Œå¹¶ä¸”é•¿åº¦ä¸è¶…è¿‡ 10000ã€‚

**ç¤ºä¾‹ 1:**

```java
è¾“å…¥ï¼š"abab"

è¾“å‡ºï¼šTrue

è§£é‡Šï¼šå¯ç”±å­å­—ç¬¦ä¸² "ab" é‡å¤ä¸¤æ¬¡æ„æˆã€‚
```

**ç¤ºä¾‹ 2:**

```java
è¾“å…¥ï¼š"aba"

è¾“å‡ºï¼šFalse
```

**ç¤ºä¾‹ 3:**

```java
è¾“å…¥ï¼š"abcabcabcabc"

è¾“å‡ºï¼šTrue

è§£é‡Šï¼šå¯ç”±å­å­—ç¬¦ä¸² "abc" é‡å¤å››æ¬¡æ„æˆã€‚ ï¼ˆæˆ–è€…å­å­—ç¬¦ä¸² "abcabc" é‡å¤ä¸¤æ¬¡æ„æˆã€‚)
```

**è§£æ³•ä¸€**

è¿™é¢˜æ ‡æ³¨çš„ä¹Ÿæ˜¯ç®€å•ï¼Œç¡®å®æš´åŠ›çš„è§£æ³•ä¸éš¾æƒ³åˆ°ï¼Œä½†æ˜¯å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥å°±ç›´æ¥ä¸Š kmp

```java
//20msï¼Œåšå¤æ‚äº†ï¼Œæ„é€ äº†ä¸€ä¸ª s+s ç„¶åå»æ‰å¤´ï¼Œå†åœ¨é‡Œé¢ kmp æ‰¾
public boolean repeatedSubstringPattern(String s) {
    if(s==null || s.length()<=0) return false;
    String t=s+s;
    int[] next=getNext(s);
    int i=0,j=1; //å»æ‰å¤´
    while(i<s.length() && j<t.length()){
        if(s.charAt(i)==t.charAt(j)){
            i++;j++;
        }else if(next[i]==-1){
            j++;
        }else{
            i=next[i];
        }
    }
    return j-i!=s.length();
}

public int[] getNext(String s){
    if(s.length()==1){
        return new int[]{-1};
    }
    int[] next=new int[s.length()];
    next[0]=-1;
    next[1]=0;
    int left=0,right=2; 
    while(right<s.length()){
        if(s.charAt(left)==s.charAt(right-1)){
            next[right++]=++left;
        }else if(next[left]==-1){
            next[right++]=0;
        }else{
            left=next[left];
        }
    }
    return next;
}
```
è¿™ä¸ªè§£æ³•å…¶å®æ„é€ äº†ä¸€ä¸ª`s+s`çš„å­—ç¬¦`t`ï¼Œç„¶åå»æ‰å¤´ï¼Œåœ¨`t[1:]`ä¸­æ‰¾åŸ`s`ï¼Œæœ€åæ‰¾åˆ°çš„ä½ç½®åªè¦ä¸æ˜¯`s+s`è¿æ¥å¤„ï¼Œä¹Ÿå°±æ˜¯`s.length()`ä½ç½®ï¼Œé‚£ä¹ˆå°±è‚¯å®šæ˜¯é‡å¤çš„æœ‰å¾ªç¯çš„ï¼Œå…¶å®è¿™ä¸ªç»“è®ºåœ¨å†™çš„æ—¶å€™å¹¶æ²¡æœ‰è¯æ˜ï¼Œå®Œå…¨æ˜¯çŒœçš„ğŸ˜‚ï¼Œç®€å•è¯æ˜ä¸‹ï¼Œä¸€å›¾èƒœå‰è¨€

![mark](http://static.imlgw.top/blog/20200513/O4Nmz343e9Li.png?imageslim)

**è§£æ³•äºŒ**

å…¶å®åªéœ€è¦æ„é€  next æ•°ç»„ï¼Œæ ¹æ® next æ•°ç»„å°±å¯ä»¥åˆ¤æ–­æ˜¯ä¸æ˜¯é‡å¤çš„ï¼Œæˆ‘ä»¬çœ‹å‡ ç»„æ•°æ®

```java
   s:  a b c a b c a b c a b c \0
next: -1 0 0 0 1 2 3 4 5 6 7 8  9
   s:  a a b a b d \0
next: -1 0 1 0 1 0  0
   s:  a b c d a b \0
next: -1 0 0 0 0 1 2 
```

ç›¸æ¯”å¸¸è§„çš„ KMP ç®—æ³•ï¼Œæˆ‘ä»¬åœ¨å­—ç¬¦æœ€åæœ€åä¹ŸåŠ äº†`next`ä½ï¼Œå…¶å®æ˜¯ä¸ºäº†åŒºåˆ«ä¸‹é¢çš„æƒ…å†µ

```
   s:  a b a b \0
next: -1 0 0 1 2
   s:  a b a c \0
next: -1 0 0 1 0
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œnext æ•°ç»„åœ¨è¿‡äº†ä¸€å®šçš„èŒƒå›´åå°±å¼€å§‹é€æ¸é€’å¢äº†ï¼Œè€Œè¿™ä¸ªé€’å¢çš„æ‹ç‚¹å°±æ˜¯åœ¨ç¬¬ä¸€ä¸ªå¾ªç¯èŠ‚ç»“æŸçš„æ—¶å€™ï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘å°±ä¸è¯¦ç»†è¯æ˜äº†ï¼Œå…¶å®ä¹Ÿå¾ˆå¥½æƒ³å› ä¸ºè¿‡äº†å¾ªç¯èŠ‚ï¼Œåé¢çš„éƒ½æ˜¯å’Œå‰é¢é‡å¤çš„ï¼Œæ‰€ä»¥æ¯å¤šä¸€ä¸ªå­—ç¬¦`next[i]=next[i-1]+1`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å­—ç¬¦çš„é•¿åº¦å‡å»`next[slen]`å°±å¯ä»¥å¾—åˆ°å¾ªç¯ç»“çš„é•¿åº¦ï¼Œæˆ‘ä»¬åªéœ€è¦éªŒè¯è¿™ä¸ªå¾ªç¯èŠ‚èƒ½å¦è¢«`s`å­—ç¬¦ä¸²é•¿åº¦æ•´é™¤å°±å¯ä»¥äº†ï¼ŒåŒæ—¶éœ€è¦é˜²æ­¢å¾ªç¯èŠ‚é•¿åº¦ç­‰äºå­—ç¬¦ä¸²é•¿åº¦çš„æƒ…å†µ

```java
public boolean repeatedSubstringPattern(String s) {
    if(s==null || s.length()<=1) return false;
    int[] next=getNext(s);
    int replen=s.length()-next[s.length()];
    //å¾ªç¯ç»“é•¿åº¦ç­‰äºå­—ç¬¦é•¿åº¦
    return replen!=s.length() && s.length()%replen==0;
}

public int[] getNext(String s){
    if(s.length()==1){
        return new int[]{-1};
    }
    int[] next=new int[s.length()+1];
    next[0]=-1;
    next[1]=0;
    int left=0,right=2; 
    while(right<=s.length()){
        if(s.charAt(left)==s.charAt(right-1)){
            next[right++]=++left;
        }else if(next[left]==-1){
            next[right++]=0;
        }else{
            left=next[left];
        }
    }
    return next;
}
```

å®åœ¨ä¸è¡ŒæŠŠè¿™ä¸ªè®°ä½å°±è¡Œäº†ï¼Œåæ­£æˆ‘æ˜¯è®°ä½äº†ğŸ˜‚ï¼ˆè¿‡å‡ å¤©å°±å¿˜äº†

### [214. æœ€çŸ­å›æ–‡ä¸²](https://leetcode-cn.com/problems/shortest-palindrome/)

ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² ***s***ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨å­—ç¬¦ä¸²å‰é¢æ·»åŠ å­—ç¬¦å°†å…¶è½¬æ¢ä¸ºå›æ–‡ä¸²ã€‚æ‰¾åˆ°å¹¶è¿”å›å¯ä»¥ç”¨è¿™ç§æ–¹å¼è½¬æ¢çš„æœ€çŸ­å›æ–‡ä¸²ã€‚

**ç¤ºä¾‹ 1:**

```java
è¾“å…¥ï¼š"aacecaaa"
è¾“å‡ºï¼š"aaacecaaa"
```

**ç¤ºä¾‹ 2:**

```java
è¾“å…¥ï¼š"abcd"
è¾“å‡ºï¼š"dcbabcd"
```

**è§£æ³•ä¸€**

è¿™é¢˜å¾ˆå…³é”®çš„ä¸€ä¸ªç‚¹å°±æ˜¯æœ€çŸ­å›æ–‡ä¸²å…¶å®å°±æ˜¯åŸå­—ç¬¦`s`ï¼Œå‡å»`s[0]`å¼€å¤´çš„æœ€é•¿å›æ–‡ä¸²ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å†æ”¾åˆ°`s`å‰ï¼Œè¿™å°±æ˜¯æœ€çŸ­å›æ–‡ä¸²

æ‰€ä»¥é—®é¢˜å°±å˜æˆäº†å¦‚ä½•æ±‚`s[0]`å¼€å¤´çš„æœ€é•¿å›æ–‡ä¸²ï¼Œæœ´ç´ çš„æ€è·¯å¯ä»¥ä½¿ç”¨ä¸­å¿ƒæ‰©æ•£æ³•ï¼Œæšä¸¾æ‰€æœ‰çš„å­—ç¬¦å’Œé—´éš™ï¼Œæˆ–è€…ä½¿ç”¨"é©¬æ‹‰è½¦"ï¼Œç­‰é«˜æ•ˆç®—æ³•ï¼Œè¿™é‡Œä¸å¤šä»‹ç»ï¼Œä¸»è¦ä»‹ç» kmp çš„åšæ³•

æˆ‘ä»¬æŠŠ`s`ä¸²ç¿»è½¬å˜æˆ`rs`ï¼Œç„¶åå°†ä¸¤éƒ¨åˆ†æ‹¼æ¥èµ·æ¥å˜ä¸º`s+rs`ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦æ±‚`s[0]`å¼€å¤´çš„æœ€é•¿å›æ–‡å­ä¸²ï¼Œå®é™…ä¸Šå°±å˜æˆäº†æ±‚`s+rs`çš„æœ€é•¿å…¬å…±å‰åç¼€

![mark](http://static.imlgw.top/blog/20200518/CtFIYht31mIL.png?imageslim)

è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯`s+rs`çš„ä¸­é—´åº”è¯¥åŠ åˆ†éš”ç¬¦ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å…¬å…±å‰åç¼€è¿‡é•¿ï¼Œç”šè‡³æ¯”åŸå­—ç¬¦`s`è¿˜è¦é•¿ï¼Œè¿™è‚¯å®šæ˜¯ä¸å¯¹çš„ï¼Œå°±æ¯”å¦‚`aaaaaaa`è¿™æ ·çš„ caseï¼ŒåŠ äº†åˆ†å‰²ç¬¦ä¹‹åæœ€é•¿çš„å‰åç¼€å°±ä¸ä¼šè¶…è¿‡`s`äº†ï¼Œ

```java
public String shortestPalindrome(String s) {
    String rs=new StringBuilder(s).reverse().toString();
    //#æ˜¯ä¸ºäº†é¿å…å‰åç¼€è¿‡é•¿è¶…è¿‡åŸå­—ç¬¦ s çš„é•¿åº¦ï¼Œæ¯”å¦‚ aaaaaaa è¿™ç§
    String t=s+"#"+rs; 
    int[] next=new int[t.length()+1];
    next[0]=-1;
    next[1]=0;
    int left=0;
    int i=2;
    while(i<=t.length()){
        if(t.charAt(i-1)==t.charAt(left)){
            next[i++]=++left;
        }else if(next[left]==-1){
            next[i++]=0;
        }else{
            left=next[left];
        }
    }
    //System.out.println(next[t.length()]);
    return rs.substring(0,s.length()-next[t.length()])+s;
}
```

### [1392. æœ€é•¿å¿«ä¹å‰ç¼€](https://leetcode-cn.com/problems/longest-happy-prefix/)

ã€Œå¿«ä¹å‰ç¼€ã€æ˜¯åœ¨åŸå­—ç¬¦ä¸²ä¸­æ—¢æ˜¯Â éç©º å‰ç¼€ä¹Ÿæ˜¯åç¼€ï¼ˆä¸åŒ…æ‹¬åŸå­—ç¬¦ä¸²è‡ªèº«ï¼‰çš„å­—ç¬¦ä¸²ã€‚

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¯·ä½ è¿”å›å®ƒçš„**æœ€é•¿å¿«ä¹å‰ç¼€**ã€‚

å¦‚æœä¸å­˜åœ¨æ»¡è¶³é¢˜æ„çš„å‰ç¼€ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚

**ç¤ºä¾‹ 1ï¼š**

```java
è¾“å…¥ï¼šs = "level"
è¾“å‡ºï¼š"l"
è§£é‡Šï¼šä¸åŒ…æ‹¬ s è‡ªå·±ï¼Œä¸€å…±æœ‰ 4 ä¸ªå‰ç¼€ï¼ˆ"l", "le", "lev", "leve"ï¼‰å’Œ 4 ä¸ªåç¼€ï¼ˆ"l", "el", "vel", "evel"ï¼‰ã€‚æœ€é•¿çš„æ—¢æ˜¯å‰ç¼€ä¹Ÿæ˜¯åç¼€çš„å­—ç¬¦ä¸²æ˜¯ "l" ã€‚

```
**ç¤ºä¾‹ 2ï¼š**

```java
è¾“å…¥ï¼šs = "ababab"
è¾“å‡ºï¼š"abab"
è§£é‡Šï¼š"abab" æ˜¯æœ€é•¿çš„æ—¢æ˜¯å‰ç¼€ä¹Ÿæ˜¯åç¼€çš„å­—ç¬¦ä¸²ã€‚é¢˜ç›®å…è®¸å‰åç¼€åœ¨åŸå­—ç¬¦ä¸²ä¸­é‡å ã€‚
```
**ç¤ºä¾‹ 3ï¼š**

```java
è¾“å…¥ï¼šs = "leetcodeleet"
è¾“å‡ºï¼š"leet"
```
**ç¤ºä¾‹ 4ï¼š**

```java
è¾“å…¥ï¼šs = "a"
è¾“å‡ºï¼š""
```

**æç¤ºï¼š**
- 1 <= s.length <= 10^5
- s åªå«æœ‰å°å†™è‹±æ–‡å­—æ¯

**è§£æ³•ä¸€**

æœ€è¿‘æŸæ¬¡å‘¨èµ›çš„ T4ï¼Œæ²¡å‚åŠ ï¼Œä»Šå¤©çœ‹è§ç¾¤é‡Œæœ‰äººæåˆ°äº†ï¼Œçœ‹äº†ä¸‹å‘ç°æ˜¯è£¸ KMP... æ­£å¥½å¤ä¹ ä¸‹ï¼Œç»“æœå†™å‡º bug äº†ã€‚

```golang
func longestPrefix(s string) string {
    if len(s) == 1 {
        return ""
    }
    //è£¸ KMP
    next := make([]int, len(s)+1)
    next[0] = -1
    next[1] = 0
    var left = 0
    var i = 2
    for i <= len(s) {
        if s[i-1] == s[left] {
            left++
            next[i] = left
            i++
        } else if next[left] == -1 {
            i++
        } else {
            left = next[left]
        }
    }
    return s[0:next[len(s)]]
}
```
ç¡®å®ä¹Ÿé•¿æ—¶é—´æ²¡æœ‰å¤ä¹  kmp äº†ï¼Œkmp çš„ç»†èŠ‚å‡ ä¹éƒ½å¿˜äº†ï¼Œä¸Šé¢çš„éƒ½æ˜¯å‡­å€Ÿç€ä¸€ç‚¹ç†è§£å’Œè®°å¿†å†™çš„
> æ£€æŸ¥äº†å‰é¢ kmp çš„å†™æ³•ï¼Œç¨å¾®æ”¹è¿›äº†ä¸€ä¸‹ï¼Œç›®å‰ç»Ÿä¸€äº†å†™æ³•

### [796. æ—‹è½¬å­—ç¬¦ä¸²](https://leetcode-cn.com/problems/rotate-string/)

ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œ`A`Â å’ŒÂ `B`ã€‚

`A`Â çš„æ—‹è½¬æ“ä½œå°±æ˜¯å°†Â `A` æœ€å·¦è¾¹çš„å­—ç¬¦ç§»åŠ¨åˆ°æœ€å³è¾¹ã€‚Â ä¾‹å¦‚ï¼Œè‹¥Â `A = 'abcde'`ï¼Œåœ¨ç§»åŠ¨ä¸€æ¬¡ä¹‹åç»“æœå°±æ˜¯`'bcdea'`Â ã€‚å¦‚æœåœ¨è‹¥å¹²æ¬¡æ—‹è½¬æ“ä½œä¹‹åï¼Œ`A`Â èƒ½å˜æˆ`B`ï¼Œé‚£ä¹ˆè¿”å›`True`ã€‚

```java
ç¤ºä¾‹ 1:
è¾“å…¥ï¼šA = 'abcde', B = 'cdeab'
è¾“å‡ºï¼štrue
```
```java
ç¤ºä¾‹ 2:
è¾“å…¥ï¼šA = 'abcde', B = 'abced'
è¾“å‡ºï¼šfalse
```

**æ³¨æ„ï¼š**

*   `A` å’ŒÂ `B`Â é•¿åº¦ä¸è¶…è¿‡Â `100`ã€‚

**è§£æ³•ä¸€**

ç»å…¸ easy é¢˜å½“ hard åšï¼Œè¿™ä¸ªé¢˜æ•°æ®é‡å¾ˆå°ï¼Œç›´æ¥æš´åŠ›å°±è¡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦è¿½æ±‚æ›´å¥½çš„è§£æ³•

ä¸€å¼€å§‹æ˜¯åœ¨ä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°äº†è¿™ä¸ªé¢˜ï¼Œé‡Œé¢è¯´äº†è¿™ä¸ªé¢˜æ˜¯ kmpï¼Œæˆ‘çœ‹äº†ä¸‹æ²¡æƒ³åˆ°ä»€ä¹ˆå¥½çš„æ€è·¯ï¼Œåªæƒ³åˆ°äº†ä¸€ä¸ª NlogN çš„åšæ³•ï¼ŒäºŒåˆ†+kmp æ‰¾æ—‹è½¬ç‚¹ï¼Œç„¶å kmp åˆ¤æ–­æ—‹è½¬ç‚¹åæ—¶å€™ä¹Ÿå­˜åœ¨äº A å­—ç¬¦ä¸­ï¼ˆç±»ä¼¼äºŒåˆ†ç­”æ¡ˆï¼‰
```golang
//ä¸å¤Ÿèªæ˜çš„åšæ³•ï¼šäºŒåˆ†+KMP æ—¶é—´å¤æ‚åº¦ O(NlogN)
func rotateString(A string, B string) bool {
    if len(A) != len(B) {
        return false
    }
    if A == B {
        return true
    }
    var left = 0
    var right = len(B) - 1
    var rotate = -1
    //äºŒåˆ†æ‰¾æ—‹è½¬ç‚¹
    for left <= right {
        mid := left + (right-left)/2
        if kmp(A, B[:mid+1]) != -1 {
            rotate = mid
            left++
        } else {
            right--
        }
    }
    if rotate == -1 {
        return false
    }
    return kmp(A, B[rotate+1:]) != -1
}

func kmp(A string, t string) int {
    var next = getNext(t)
    var Ai = 0
    var ti = 0
    for Ai < len(A) && ti < len(t) {
        if A[Ai] == t[ti] {
            Ai++
            ti++
        } else if next[ti] == -1 {
            Ai++
        } else {
            ti = next[ti]
        }
    }
    if ti == len(t) {
        return Ai - 1
    }
    return -1
}

func getNext(t string) []int {
    if len(t) < 2 {
        return []int{-1}
    }
    var next = make([]int, len(t))
    var left = 0
    next[0] = -1
    next[1] = 0
    var i = 2
    for i < len(t) {
        if t[left] == t[i-1] {
            left++
            next[i] = left
            i++
        } else if next[left] == -1 {
            i++
        } else {
            left = next[left]
        }
    }
    return next
}
```

**è§£æ³•äºŒ**

çœ‹äº†è¯„è®ºåŒºçš„å¤§ä½¬çš„åšæ³•ï¼Œå®é™…ä¸Š`A+A`å°±åŒ…å«äº†æ‰€æœ‰çš„æ—‹è½¬`A`çš„ç»“æœå­ä¸²ï¼Œ`A+A`å°±ç›¸å½“äºé¦–ä½ç›¸è¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨`A+A`ä¸­ kmp æ‰¾`B`å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦`O(N)`

```golang
//èªæ˜çš„è§£æ³•ï¼šA+A åŒ…å«äº†æ‰€æœ‰å¯èƒ½çš„æ—‹è½¬æƒ…å†µï¼Œç›´æ¥å¯¹ A+A å’Œ B åš kmp å°±è¡Œäº†
//abcdeabcde
func rotateString(A string, B string) bool {
    if len(A) != len(B) {
        return false
    }
    if A == B {
        return true
    }
    return kmp(A+A, B) != -1
}
```