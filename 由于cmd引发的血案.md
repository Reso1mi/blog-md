---
title: 
   ç”±äºcmdå¼•å‘çš„è¡€æ¡ˆ
tags:
   [Bug]
categories:
   [è¸©å‘è®°å½•]
date: 2019/12/8
cover: http://static.imlgw.top/4.jpg
---

## å‰è¨€

ç»™æ•™åŠ¡å¤„åšä¸€ä¸ªå·¥ä½œé‡å®¡æ ¸çš„webé¡¹ç›®ï¼Œå‰å‡ å¤©å®Œæˆåéƒ¨ç½²åœ¨æœºæˆ¿ç”µè„‘ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯æµ‹è¯•çš„æ—¶å€™å‡ºç°äº†Bugï¼Œä¼šå­˜åœ¨ä¸€ä¸ªç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œæ•´ä¸ªåº”ç”¨å¡æ­»ï¼Œæ‰€æœ‰äººéƒ½æ— æ³•ç™»é™†ï¼Œå› ä¸ºç™»é™†æ¨¡å—æ˜¯æˆ‘å†™çš„ï¼Œæˆ‘å½“æ—¶å°±æ…Œäº†ï¼ˆå¹¶ä¸ï¼‰ï¼Œç„¶åèµ¶ç´§å»æœºæˆ¿çœ‹çœ‹åˆ°åº•æ˜¯å•¥æƒ…å†µ

## FixBug

å…¶å®æˆ‘é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æ•°æ®åº“çš„é—®é¢˜ï¼Œä½†æ˜¯çœ‹äº†æˆ‘æ§åˆ¶å°çš„è¾“å‡ºï¼Œå‘ç°ä»£ç å…¶å®æ ¹æœ¬å°±è¿˜æ²¡åˆ°æ•°æ®åº“å±‚ï¼æ‰€ä»¥å…ˆæ’é™¤äº†æ•°æ®åº“çš„é—®é¢˜

ç„¶åæˆ‘å°±æƒ³åˆ°äº†å¯èƒ½æ˜¯GCçš„é—®é¢˜ï¼Œç„¶åæˆ‘æ‰“å¼€äº† `jvisualvm`ï¼Œå‡†å¤‡æŸ¥çœ‹å½“å‰çš„å †å ç”¨å’ŒGCæƒ…å†µï¼Œä½†æ˜¯ç”±äºç°åœ¨æ˜¯æ­£å¸¸çš„ï¼Œçœ‹ä¸å‡ºæ¥ä»€ä¹ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤ç°è¿™ä¸ªBugï¼Œç»“æœæˆ‘ä»¬å‡ ä¸ªäººåœ¨å“ªé‡Œæäº†åŠå¤©æ­»æ´»å¤ç°ä¸äº†ğŸ˜‚

> åœ¨ç»è¿‡æˆ‘ä»¬å¿«ä¸€ä¸ªå°æ—¶åšæŒä¸æ‡ˆçš„å°è¯•ä¸‹ï¼Œç»ˆäºå¤ç°äº†ï¼

é¡µé¢hangä½ï¼Œæ‰€æœ‰äººéƒ½æ— æ³•ç™»é™†ï¼Œåå°ä¹Ÿå¹¶æ²¡æœ‰ä»»ä½•çš„é”™è¯¯ä¿¡æ¯ï¼Œç„¶åæˆ‘èµ¶ç´§å»çœ‹äº†ä¸‹ `jvisualvm` å‘ç°å †å¹¶æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼ŒGCä¹Ÿå¹¶æ²¡æœ‰å‘ç”Ÿï¼è€Œä¸”æ›´è¯¡å¼‚çš„æ˜¯å…¶ä»–çš„å·²ç»ç™»é™†çš„äººæ˜¯å¯ä»¥æ­£å¸¸çš„æ“ä½œçš„ï¼åªæ˜¯å¡ä½äº†ç™»é™†çš„äººï¼Œæ‰€ä»¥GCçš„é—®é¢˜ä¹Ÿæ’é™¤äº†

æ’é™¤ä¸Šé¢ä¸¤ä¸ªåŸå› ï¼Œå‰©ä¸‹çš„å°±åªæœ‰ä¸€ä¸ªåŸå› äº†ï¼Œçº¿ç¨‹æ­»é”ï¼

åœ¨dumpå‡ºçº¿ç¨‹å¿«ç…§åç»ˆäºå‘ç°äº†é—®é¢˜æ‰€åœ¨

![mark](http://static.imlgw.top/blog/20191208/XKUriuCE9nTb.png?imageslim)

å›¾ä¸­çš„è¿™æ¡çº¿ç¨‹å¡åœ¨äº† `PrintStream.println()` ä¸Šï¼Œè€Œè¿™ä¸ªæ˜¯æˆ‘åœ¨Serviceæ‰“å°çš„logä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆä¼šåœ¨è¿™é‡Œå¡ä½ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸ç§‘å­¦å•Šï¼Œç„¶åæˆ‘çœ‹äº† å…¶ä»– tomcatçš„å·¥ä½œçº¿ç¨‹ï¼Œå‘ç°è¿˜æœ‰å¥½å‡ ä¸ªéƒ½æ˜¯`BLOCK` çŠ¶æ€ï¼Œéƒ½åœ¨ç­‰ `[0x0000004df8afd000]`è¿™æŠŠé”ï¼Œè¿™ä¸ªé”è¢«å¦ä¸€ä¸ªtomcatçš„å·¥ä½œçº¿ç¨‹ `http-bio-80-exec[2]` æ‰€æŒæœ‰ï¼Œè€Œä¸”å®ƒå¹¶ä¸æ˜¯`BLOCK`çŠ¶æ€ï¼Œè€Œæ˜¯ `RUNNABLE` çŠ¶æ€ï¼Œè¿™ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œ `java.io.FileOutputStream.writeBytes()` æ–¹æ³•ï¼Œæˆ‘ä»¬å»çœ‹çœ‹`println`çš„æºç 

```java
/**
 * Prints a String and then terminate the line.  This method behaves as
 * though it invokes <code>{@link #print(String)}</code> and then
 * <code>{@link #println()}</code>.
 *
 * @param x  The <code>String</code> to be printed.
 */
public void println(String x) {
    synchronized (this) {
        print(x);
        newLine();
    }
}
```

å¯ä»¥çœ‹å‡ºåœ¨printlnæ–¹æ³•ç¡®å®æ˜¯åŠ äº†é”çš„ï¼Œé”çš„å¯¹è±¡å°±æ˜¯å½“å‰çš„PrintStreamå®ä¾‹å¯¹è±¡ï¼Œè€Œå ç”¨è¿™ä¸ªé”çš„å¯¹è±¡çš„çº¿ç¨‹åˆ™æ­£åœ¨æ‰§è¡Œä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸ªæœ¬åœ°æ–¹æ³•æˆ‘ä»¬çœ‹ä¸åˆ°åº•å±‚çš„ç»†èŠ‚

```java
/**
 * Writes a sub array as a sequence of bytes.
 * @param b the data to be written
 * @param off the start offset in the data
 * @param len the number of bytes that are written
 * @param append {@code true} to first advance the position to the
 *     end of file
 * @exception IOException If an I/O error has occurred.
 */
private native void writeBytes(byte b[], int off, int len, boolean append)
    throws IOException;
```

æ— å¥ˆï¼Œå€ŸåŠ©æœç´¢å¼•æ“ï¼Œæœç„¶æŸ¥åˆ°äº†åŒæ ·çš„é—®é¢˜ 

[ä¸€ä¸ªRUNNABLEçŠ¶æ€çš„çº¿ç¨‹hangåœ¨äº†java.io.FileOutputStream.writeBytesæ–¹æ³•ä¸Š](https://my.oschina.net/u/1030459/blog/908007)

å½“ç„¶åŸé—®é¢˜æ˜¯æ¥è‡ª[StackOverflow](https://stackoverflow.com/questions/634102/log4j-is-hanging-my-application-what-am-i-doing-wrong) 

é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼šåœ¨CMDçª—å£ç‚¹å‡»äº†é»‘æ¡†ä¹‹åï¼Œæ§åˆ¶å°å°±ä¼šè¢«æš‚åœ![mark](http://static.imlgw.top/blog/20191208/1em5YGsoGyxT.png?imageslim)

ï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¹‹åå‘æ§åˆ¶å°çš„è¾“å…¥å†…å®¹éƒ½ä¼šè¢«é˜»å¡ï¼Œä½†æ˜¯æ­£åœ¨è¾“å‡ºçš„çº¿ç¨‹ä¹Ÿå¹¶ä¸ä¼š`BLOCK`ï¼ŒçŠ¶æ€ä»ç„¶æ˜¯`RUNNABLE`ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ‰€æè¿°çš„æƒ…å†µï¼Œå½“ä½ è¿™ä¸ªæ—¶å€™åœ¨CMDçŠ¶æ€ä¸‹æŒ‰ä¸€ä¸‹å›è½¦æˆ–è€…å…¶ä»–çš„é”®é‡Šæ”¾consoleï¼Œé€€å‡ºç¼–è¾‘æ¨¡å¼![mark](http://static.imlgw.top/blog/20191208/4RXkNizHfNsP.png?imageslim)

è¿™ä¸ªçº¿ç¨‹åˆä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥è°ƒæ•´cmdçš„è®¾ç½®ï¼Œæˆ‘è¿™é‡Œå…¶å®æ— æ‰€è°“ï¼Œå› ä¸ºåé¢å¹¶ä¸ä¼šåœ¨winä¸Šè¿è¡Œ

è‡³æ­¤é—®é¢˜å°±åŸºæœ¬è§£å†³äº†ï¼ˆå…¶å®éƒ½ä¸ç®—é—®é¢˜ï¼‰ï¼Œæ²¡æƒ³åˆ°è¿˜ä¼šè¢«cmdç»™å‘ä¸€æŠŠï¼Œä¸è¿‡å¢é•¿äº†ä¸€ç‚¹æ’æŸ¥é—®é¢˜çš„èƒ½åŠ›ä¹Ÿè¿˜æ˜¯ä¸é”™çš„ğŸ˜